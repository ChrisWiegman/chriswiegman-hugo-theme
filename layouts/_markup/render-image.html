{{- $image := resources.Get .Destination -}}
{{- $imgSrcSet := slice -}}
{{- with $widths := site.Params.imageSizes -}}
{{- range $widths -}}
{{- $srcUrl := (printf "%gx" . | $image.Resize).Permalink -}}
{{- $imgSrcSet = $imgSrcSet | append (printf "%s %gw" $srcUrl .) -}}
{{- end -}}
{{- $imgSrcSet = (delimit $imgSrcSet ",") -}}
{{- end -}}
{{- if .IsBlock -}}
<figure>
    <img{{ with .Title }} class="with-caption"{{ end }} width="{{ $image.Width }}" height="{{ $image.Height }}" src="{{ $image.RelPermalink }}" alt="{{ .Text | htmlEscape }}" decoding="async" fetchpriority="high"{{ if $imgSrcSet }} srcset="{{ $imgSrcSet }}" sizes="{{ site.Params.imageSizeString }}"{{ end }} />
    {{- with .Title }}<figcaption>{{ . }}</figcaption>{{- end -}}
</figure>
{{- else -}}
<img width="{{ $image.Width }}" height="{{ $image.Height }}" src="{{ $image.RelPermalink }}" alt="{{ .Text | htmlEscape }}" decoding="async" fetchpriority="high"{{ if $imgSrcSet }} srcset="{{ $imgSrcSet }}" sizes="{{ site.Params.imageSizeString }}"{{ end }}{{ with .Title }} title="{{ . }}"{{ end }} />
{{- end -}}
